# Activity 5: Variant filtering 

## Introduction to BCFtools 

Yesterday we used the variant caller built into BCFtools, but BCFtools is actually a very large program with a lot of functions for processing VCF files. 

Take a minute to look at the [manual](https://samtools.github.io/bcftools/bcftools.html) and see the different functions. 

## Filter for quality

```{cat, class.source='foldable'}
bcftools filter -S . -e "FMT/DP<10 | FMT/GQ<20 | QUAL<40" moch21_bcftools.vcf.gz | bgzip -c > moch21.filtered.vcf.gz
```

How did the file change? How many sites are in the file now? 

```{cat, class.source='foldable'}
bcftools view -H moch21_bcftools.vcf.gz | wc -l
bcftools view -H moch21.filtered.vcf.gz | wc -l
```

## Filter for biallelic SNPs

```{cat, class.source='foldable'}
bcftools view -type SNP -m 2 -M 2 moch21.filtered.vcf.gz > moch21.filtered.bSNPs.vcf.gz 
```

## Filter for frequency

```{cat, class.source='foldable'}
bcftools view -ac 2 moch21.filtered.vcf.gz > moch21.filtered.minAC2.vcf.gz 
bcftools view -q > 0.5 moch21.filtered.vcf.gz > moch21.filtered.minFreq05.vcf.gz 
```

## Assignment 

Write a batch script to filter the file you made yesterday for quality and remove indels. 

*Hint 1:* 

```{cat, class.source='foldable'}
You can combine multiple filtering flags into one bcftools command.  
```

